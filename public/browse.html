
<!-- BROWSE -->

<script type="text/template"
        route="^browse"
        page-title="Browse Music"
        completed="completedBrowseMusic"
        transform="transformBrowseMusic">
    {{#data}}
    <div class="page width center panel">
        <table data-set="browse-music" trigger-target="filterBrowseMusic" class="form">
            <tbody>
                <tr>
                    <th>Tags</th>
                    <td>
                        <input type="text" name="tags" placeholder="Song Tags" />
                    </td>
                </tr>
                <tr>
                    <th>Genres</th>
                    <td>
                        <input type="text" name="genres" placeholder="Song Genres" />
                    </td>
                </tr>
                <tr>
                    <th>Types</th>
                    <td>
                        <ul>
                        {{#releaseTypes}}
                            <li>
                                <input type="checkbox" name="types" value="{{key}}" id="type-{{key}}" {{#checked}}checked="true"{{/checked}} />
                                <label for="type-{{key}}">{{name}}</label>
                            </li>
                        {{/releaseTypes}}
                        </ul>
                    </td>
                </tr>
                <tr>
                    <th></th>
                    <td>
                        <button action="filterBrowseMusic" trigger="filterBrowseMusic" data-set-target="browse-music">Filter</button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>        
    <div source="$endpoint/catalog/browse?{{query}}"
         template="music-browse">
    </div>
    {{/data}}
</script>

<script type="text/template"
        template-name="music-browse"
        transform="transformMusicBrowseResults">
    {{#loading}}
    {{>loading-view}}
    {{/loading}}
    {{#error}}
    <div class="page width center panel">
        <p>{{message}}</p>
    </div>
    {{/error}}
    {{#data}}
    {{#results.length}}
    <ul class="page width center panel browse-testing">
        {{> browseMusicTable}}
    </ul>
    {{/results.length}}
    {{^total}}
    <div class="page width center text center panel">No results found.</div>
    {{/total}}
    {{#total}}
      <div class="page width center pagination pad-vertical text center">
          {{#previous}}
            <a href="?{{previous}}">Previous</a>
          {{/previous}}
          <label>{{skip}} - {{count}} of {{total}}</label>
          {{#next}}
            <a href="?{{next}}">Next</a>
          {{/next}}
      </div>
    {{/total}}
    {{/data}}
</script>

<script type="text/template"
        mustache-name="browseMusicTable">
    {{#results.length}}
    <table>
        <thead>
            <tr>
                <th class="shrink"></th>
                <th>Title</th>
                <th>Artists</th>
                <th>Genre</th>
                <th>BPM</th>
                <th>Release</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            {{#results}}
            <tr>
                <td class="shrink">
                  {{>playSong}}
                </td>
                {{>trackCells}}
                <td>
                    <a href="/release/{{release.catalogId}}">{{release.title}}</a>
                </td>
                <td class="push-children-right">
                    {{>trackButtons}}
                    {{#canPlaylist}}
                    <select
                        onchange="addToPlaylist(null, this)"
                        source="$endpoint/playlist"
                        template="select-playlist"
                        track-id="{{_id}}">
                    </select>
                    {{/canPlaylist}}
                </td>
            </tr>
            {{/results}}
        </tbody>
    </table>
    {{/results.length}}
</script>